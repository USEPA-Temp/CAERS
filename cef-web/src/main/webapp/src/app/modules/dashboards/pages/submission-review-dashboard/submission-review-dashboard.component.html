<!--
 * Â© Copyright 2019 EPA CAERS Project Team
 *
 * This file is part of the Common Air Emissions Reporting System (CAERS).
 *
 * CAERS is free software: you can redistribute it and/or modify it under the 
 * terms of the GNU General Public License as published by the Free Software Foundation, 
 * either version 3 of the License, or (at your option) any later version.
 *
 * CAERS is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without 
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with CAERS.  If 
 * not, see <https://www.gnu.org/licenses/>.
-->
<div>

   <div class="row">
      <div class="col-sm-12 col-md-9">

         <div class="card">
            <div class="card-header text-center">
               <strong>Submissions</strong>
            </div>

            <div class="d-flex flex-row pl-2 py-3" *ngIf="user?.isAdmin()">
               <label for="admin-agency-select" class="col-form-label col-form-label-sm mr-2">
                  <strong>Agency:</strong>
               </label>
               <select id="admin-agency-select" style="width: auto"
                       class="form-control form-control-sm" #sltSelect
                       [(ngModel)]="selectedAgency" 
                       (change)="onAgencySelected()" aria-label="select agency">
                  <option value=""></option>
                  <option *ngFor="let opt of agencyDataValues" [ngValue]="opt">{{opt.programSystemCode.code}} - {{opt.programSystemCode.description}}</option>
               </select>
               <hr>
            </div>

            <div class="d-flex flex-row pl-2 py-3">
               <label for="cbo-report-status" class="col-form-label col-form-label-sm mr-2">
                  <strong>Report Status:</strong>
               </label>
               <select id="cbo-report-status" style="width: 150px"
                       class="form-control form-control-sm mr-3" #statusSelect
                       [(ngModel)]="selectedReportStatus"
                       (change)="onStatusSelected()" aria-label="select report status">
                  <option value="SUBMITTED">Pending Review</option>
                  <option value="IN_PROGRESS">In Progress</option>
                  <option value="RETURNED">Reviewed and Returned</option>
                  <option value="ADVANCED_QA">Advanced QA</option>
                  <option value="APPROVED">Accepted</option>
               </select>
               <label for="cbo-report-year" class="col-form-label col-form-label-sm mr-2">
                  <strong>Report Year:</strong>
               </label>
               <select id="cbo-report-year" style="width: 150px;"
                       class="form-control form-control-sm mr-3" #yearSelect
                       [(ngModel)]="selectedYear"
                       (change)="refreshFacilityReports()" aria-label="select report year">
                  <option [ngValue]="undefined">All Years</option>
                  <option *ngFor="let opt of selectedAgency?.years" [value]="opt">{{opt}}</option>
               </select>
               <label for="cbo-industry-sector" class="col-form-label col-form-label-sm mr-2">
                  <strong>Industry Sector:</strong>
               </label>
               <select id="cbo-industry-sector" style="width: 150px;"
                       class="form-control form-control-sm" #industrySelect
                       (change)="onIndustrySelected(industrySelect.value)" aria-label="select industry sector">
                  <option value="null" selected>All Sectors</option>
                  <option *ngFor="let opt of industrySectors" [value]="opt">{{opt}}</option>
               </select>
            </div>

            <app-submission-review-list [reviewer]="user.isReviewer()"
                                        [tableData]="submissions" [reportStatus]="statusSelect.value"></app-submission-review-list>

            <div class="validation-message p-3" *ngIf="invalidSelection">
               <span>At least one submission must be selected.</span>
            </div>

            <div class="card-footer">
               <div class="row" *ngIf="user?.isReviewer()">
                  <div class="col-sm-3" style="text-align: align-left">
                     <button class="btn btn-success btn-md"
                           *ngIf="statusSelect.value === 'SUBMITTED'"
                        (click)="onBeginAdvancedQA(yearSelect.value)">
                     <span>Begin Advanced QA</span>
                  </button>
                  </div>
                  <div class="col-sm-9" style="text-align: right">
                     <button class="btn btn-primary btn-md mr-3"
                           *ngIf="statusSelect.value !== 'IN_PROGRESS' && statusSelect.value !== 'RETURNED'"
                           (click)="onReject(yearSelect.value)">
                        <span>Reject and Return to Facility</span>
                     </button>
                     <button class="btn btn-success btn-md"
                              *ngIf="!hideButtons"
                           (click)="onApprove(yearSelect.value)">
                        <span>Accept and Submit to EIS</span>
                     </button>
                  </div>
               </div>
            </div>
         </div>
      </div>


      <div class="col-sm-12 col-md-3">
         <app-notification-list></app-notification-list>
      </div>
   </div>
</div>
